{"ast":null,"code":"import _toConsumableArray from\"C:/Users/sirvi/Documents/IT-tradenomikoulutus/OhjelmistoProjektiI/TicketGuru/ticketguruclient/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";import _slicedToArray from\"C:/Users/sirvi/Documents/IT-tradenomikoulutus/OhjelmistoProjektiI/TicketGuru/ticketguruclient/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import{Typography,Button}from\"@mui/material\";import{LibraryAddOutlined}from'@mui/icons-material';import{useEffect,useState}from\"react\";import{useUser}from'../util/UserProvider';import axios from\"axios\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";export default function CreateTickets(props){var _useState=useState([]),_useState2=_slicedToArray(_useState,2),newTickets=_useState2[0],setNewTickets=_useState2[1];var _useState3=useState([]),_useState4=_slicedToArray(_useState3,2),tickets=_useState4[0],setTickets=_useState4[1];var _useState5=useState(''),_useState6=_slicedToArray(_useState5,2),viesti=_useState6[0],setViesti=_useState6[1];var _useState7=useState(false),_useState8=_slicedToArray(_useState7,2),fetchingTickets=_useState8[0],setFetchingTickets=_useState8[1];var user=useUser();var dayjs=require('dayjs');var handleSubmit=function handleSubmit(){// Create a Salesevent and then create Tickets by looping selectedTicketTypes\n// Build body for SalesEvent call\n//console.log(props.user)\n//setFinalPrice(invoiceTotal);\nconsole.log('InvoiceTotal: ',props.invoiceTotal);var saleseventbody={sale_date:dayjs().format('YYYY-MM-DDTHH:mm:ss'),deleted:false,final_price:props.invoiceTotal,appUser:{appuser_id:user.userInfo.appuser_id,userrole:user.userInfo.userrole}};// Start tracking the state of fetching tickets\nsetFetchingTickets(true);// Call POST /salesevents to create SalesEvent\n// After creating Salesevent, start looping TicketTypes and creating Tickets:\n//      Build body for Ticket call\n//      Create Tickets by calling POST /tickets\naxios.post(\"http://localhost:8080/salesevents\",saleseventbody,{headers:{'Authorization':\"Bearer \".concat(user.jwt)}}).then(function(response){console.log('SalesEvent created: ',response.data);var selectedSalesEvent=response.data.salesevent_id;props.selectedTicketTypes.map(function(tt){var ticketbody={ticketType:{ticket_type_id:tt[0].ticket_type_id},salesEvent:{salesevent_id:selectedSalesEvent}};return axios.post(\"http://localhost:8080/tickets\",ticketbody,{headers:{'Authorization':\"Bearer \".concat(user.jwt)}}).then(function(response){console.log('Ticket created: ',response.data);setNewTickets(function(prevTickets){return[].concat(_toConsumableArray(prevTickets),[response.data.ticket_id]);});}).catch(function(error){console.log('Error creating Ticket: ',error);});});setViesti('Myyntitapahtuma suoritettu');console.log(newTickets);axios.get('http://localhost:8080/tickets',{headers:{'Authorization':\"Bearer \".concat(user.jwt)}}).then(function(response){console.log('Tickets fetched: ',response.data);setTickets(response.data.filter(function(ticket){return newTickets.includes(ticket.ticket_id);}));console.log('New Tickets: ',tickets);}).catch(function(error){console.log('Error fetching tickets: ',error);});}).catch(function(error){console.log('Error creating SalesEvent: ',error);setViesti('Myyntitapahtuma epäonnistui');}).finally(function(){return setFetchingTickets(false);});};useEffect(function(){if(newTickets.length&&!fetchingTickets){axios.get('http://localhost:8080/tickets',{headers:{Authorization:\"Bearer \".concat(user.jwt)}}).then(function(response){console.log('Tickets fetched: ',response.data);setTickets(response.data.filter(function(ticket){return newTickets.includes(ticket.ticket_id);}));console.log('New Tickets: ',tickets);props.setNewTickets(newTickets);props.setTickets(tickets);}).catch(function(error){console.log('Error fetching tickets: ',error);});}},[newTickets,fetchingTickets,tickets,props,user.jwt]);useEffect(function(){if(tickets.length&&!fetchingTickets){props.setTickets(tickets);}},[tickets,fetchingTickets,props]);return/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(Button,{variant:\"contained\",onClick:handleSubmit,disabled:props.invoiceSubtotal===0||tickets.length,sx:{m:1},children:[/*#__PURE__*/_jsx(LibraryAddOutlined,{}),/*#__PURE__*/_jsx(Typography,{sx:{pl:2},children:\"Vahvista myyntitapahtuma\"})]}),/*#__PURE__*/_jsx(Typography,{hidden:!viesti,sx:{background:'#eeeeee',p:1,width:1/4},children:viesti})]});};","map":{"version":3,"names":["Typography","Button","LibraryAddOutlined","useEffect","useState","useUser","axios","jsx","_jsx","jsxs","_jsxs","CreateTickets","props","_useState","_useState2","_slicedToArray","newTickets","setNewTickets","_useState3","_useState4","tickets","setTickets","_useState5","_useState6","viesti","setViesti","_useState7","_useState8","fetchingTickets","setFetchingTickets","user","dayjs","require","handleSubmit","console","log","invoiceTotal","saleseventbody","sale_date","format","deleted","final_price","appUser","appuser_id","userInfo","userrole","post","headers","concat","jwt","then","response","data","selectedSalesEvent","salesevent_id","selectedTicketTypes","map","tt","ticketbody","ticketType","ticket_type_id","salesEvent","prevTickets","_toConsumableArray","ticket_id","catch","error","get","filter","ticket","includes","finally","length","Authorization","children","variant","onClick","disabled","invoiceSubtotal","sx","m","pl","hidden","background","p","width"],"sources":["C:/Users/sirvi/Documents/IT-tradenomikoulutus/OhjelmistoProjektiI/TicketGuru/ticketguruclient/src/components/CreateTickets.js"],"sourcesContent":["import { Typography, Button } from \"@mui/material\";\r\nimport { LibraryAddOutlined } from '@mui/icons-material';\r\nimport { useEffect, useState } from \"react\";\r\nimport { useUser } from '../util/UserProvider';\r\nimport axios from \"axios\";\r\n\r\nexport default function CreateTickets(props) {\r\n\r\n    const [newTickets, setNewTickets] = useState([]);\r\n    const [tickets, setTickets] = useState([]);\r\n    const [viesti, setViesti] = useState('')\r\n    const [fetchingTickets, setFetchingTickets] = useState(false);\r\n    const user = useUser();\r\n    const dayjs = require('dayjs')\r\n\r\n    const handleSubmit = () => {\r\n        // Create a Salesevent and then create Tickets by looping selectedTicketTypes\r\n\r\n        // Build body for SalesEvent call\r\n        //console.log(props.user)\r\n        //setFinalPrice(invoiceTotal);\r\n        console.log('InvoiceTotal: ', props.invoiceTotal)\r\n        const saleseventbody = {\r\n            sale_date: dayjs().format('YYYY-MM-DDTHH:mm:ss'),\r\n            deleted: false,\r\n            final_price: props.invoiceTotal,\r\n            appUser: { appuser_id: user.userInfo.appuser_id, userrole: user.userInfo.userrole }\r\n        };\r\n\r\n        // Start tracking the state of fetching tickets\r\n        setFetchingTickets(true);\r\n\r\n        // Call POST /salesevents to create SalesEvent\r\n        // After creating Salesevent, start looping TicketTypes and creating Tickets:\r\n        //      Build body for Ticket call\r\n        //      Create Tickets by calling POST /tickets\r\n        axios.post(`http://localhost:8080/salesevents`, saleseventbody,\r\n            {\r\n                headers: {\r\n                    'Authorization': `Bearer ${user.jwt}`\r\n                }\r\n            }).then((response) => {\r\n                console.log('SalesEvent created: ', response.data);\r\n                const selectedSalesEvent = response.data.salesevent_id\r\n                \r\n                props.selectedTicketTypes.map((tt) => {\r\n                    const ticketbody = {\r\n                        ticketType: { ticket_type_id: tt[0].ticket_type_id },\r\n                        salesEvent: { salesevent_id: selectedSalesEvent }\r\n                    };\r\n                    return axios.post(`http://localhost:8080/tickets`, ticketbody,\r\n                        {\r\n                            headers: {\r\n                                'Authorization': `Bearer ${user.jwt}`\r\n                            }\r\n                        }).then((response) => {\r\n                            console.log('Ticket created: ', response.data);\r\n                            setNewTickets((prevTickets) => [...prevTickets, response.data.ticket_id]);\r\n                        }).catch((error) => {\r\n                            console.log('Error creating Ticket: ', error)\r\n                        });\r\n                });\r\n                \r\n                setViesti('Myyntitapahtuma suoritettu')\r\n                console.log(newTickets);\r\n                axios.get('http://localhost:8080/tickets', {\r\n                    headers: {\r\n                        'Authorization': `Bearer ${user.jwt}`\r\n                    }\r\n                }).then((response) => {\r\n                    console.log('Tickets fetched: ', response.data);\r\n                    setTickets(response.data.filter(ticket => newTickets.includes(ticket.ticket_id)));\r\n                    console.log('New Tickets: ', tickets)\r\n                }).catch((error) => {\r\n                    console.log('Error fetching tickets: ', error);\r\n                });\r\n            }).catch((error) => {\r\n                console.log('Error creating SalesEvent: ', error)\r\n                setViesti('Myyntitapahtuma epäonnistui')\r\n            }).finally(() => setFetchingTickets(false));\r\n    };\r\n\r\n    useEffect(() => {\r\n        if (newTickets.length && !fetchingTickets) {\r\n            axios\r\n                .get('http://localhost:8080/tickets', {\r\n                    headers: {\r\n                        Authorization: `Bearer ${user.jwt}`,\r\n                    },\r\n                })\r\n                .then((response) => {\r\n                    console.log('Tickets fetched: ', response.data);\r\n                    setTickets(\r\n                        response.data.filter((ticket) =>\r\n                            newTickets.includes(ticket.ticket_id)\r\n                        )\r\n                    );\r\n                    console.log('New Tickets: ', tickets);\r\n                    props.setNewTickets(newTickets);\r\n                    props.setTickets(tickets);\r\n                })\r\n                .catch((error) => {\r\n                    console.log('Error fetching tickets: ', error);\r\n                });\r\n        }\r\n    }, [newTickets, fetchingTickets, tickets, props, user.jwt]);\r\n\r\n    useEffect(() => {\r\n        if (tickets.length && !fetchingTickets) {\r\n            props.setTickets(tickets);\r\n        }\r\n    }, [tickets, fetchingTickets, props])\r\n\r\n    return (\r\n        <div>\r\n            <Button\r\n                variant='contained'\r\n                onClick={handleSubmit}\r\n                disabled={props.invoiceSubtotal === 0 || tickets.length}\r\n                sx={{ m: 1 }}\r\n            >\r\n                <LibraryAddOutlined />\r\n                <Typography sx={{ pl: 2 }} >Vahvista myyntitapahtuma</Typography>\r\n            </Button>\r\n            <Typography hidden={!viesti} sx={{\r\n                background: '#eeeeee',\r\n                p: 1, width: 1 / 4\r\n            }}>\r\n                {viesti}\r\n            </Typography>\r\n        </div >\r\n    )\r\n};"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}